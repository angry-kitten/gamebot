#!/usr/bin/env python3
#
# Copyright 2021 by angry-kitten
# Evaluate movement time distance data.
#

import sys
import os
import time
import random
from scipy.optimize import curve_fit

# time in seconds, map distance [seconds,distance]
data_distance_time_1=[
    [0.0,0.17354436625492278],
    [0.12,0.24542879643114895],
    [0.13,0.3121343442926802],
    [0.18,0.37694088272001364],
    [0.2,0.6199208371960762],
    [0.22,0.6528945107079194],
    [0.23,0.6633296288187653],
    [0.24,0.6984621374617875],
    [0.26,0.8890996707936509],
    [0.27,0.8685964521048108],
    [0.28,0.9509722290913574],
    [0.3,0.9947973716161427],
    [0.31,0.9951318167943448],
    [0.32,1.008615989760716],
    [0.34,1.133038448689831],
    [0.35,1.1259270339241856],
    [0.36,1.1451453119439199],
    [0.37,1.2552220193615071],
    [0.38,1.25673924668647],
    [0.39,1.1806761351877986],
    [0.4,1.3110205745573897],
    [0.42,1.3492604534992658],
    [0.43,1.374494585769615],
    [0.44,1.5082039328591554],
    [0.45,1.536852076775146],
    [0.46,1.5578105476668604],
    [0.47,1.5157324904807452],
    [0.48,1.576080181223618],
    [0.49,1.5517911514104095],
    [0.5,1.7470513648996568],
    [0.51,1.6828892664478867],
    [0.52,1.7293745308758233],
    [0.53,1.832582319834586],
    [0.54,1.8526485851020924],
    [0.55,1.8609577788083442],
    [0.56,1.9199971264604339],
    [0.58,1.857487650047264],
    [0.59,2.123390903092412],
    [0.6,2.1672414817316508],
    [0.61,2.1578202509231588],
    [0.62,2.27954769560941],
    [0.64,2.2749910117021237],
    [0.65,2.2825076796738974],
    [0.66,2.2788135078281857],
    [0.67,2.4482169205291817],
    [0.68,2.3344971228530094],
    [0.69,2.29839841936024],
    [0.7,2.4918969025644624],
    [0.71,2.4233456237875513],
    [0.73,2.4494240192096797],
    [0.74,2.5687168378858116],
    [0.75,2.66032883413823],
    [0.76,2.673599810178887],
    [0.77,2.7216561713730045],
    [0.78,2.925654157882665],
    [0.79,2.851493456043626],
    [0.8,2.706532914121853],
    [0.81,2.8762345126804316],
    [0.82,2.74193657944885],
    [0.83,2.9245169394693704],
    [0.84,2.9224601369383674],
    [0.85,3.0129997467720524],
    [0.86,2.972568472180116],
    [0.89,3.107052676948343],
    [0.9,3.2681544407543957],
    [0.91,3.1923507191702467],
    [0.92,3.3334223958606564],
    [0.93,3.3929465334680633],
    [0.94,3.4061747309229333],
    [0.95,3.5346658930906814],
    [0.96,3.4101993410740756],
    [0.97,3.407113070864231],
    [0.98,3.557323246629416],
    [0.99,3.3395911451338316],
    [1.0,3.6158556879419317],
    [1.01,3.611019395263103],
    [1.02,3.594823376871629],
    [1.03,3.616813568494379],
    [1.04,3.521570906869904],
    [1.05,3.7705653348885666],
    [1.06,3.7419610471330302],
    [1.07,3.7957523229246224],
    [1.08,3.858410307860786],
    [1.09,3.8582068172090835],
    [1.1,4.002335650272157],
    [1.11,3.8552760524053666],
    [1.13,3.968815696305624],
    [1.15,4.131325180963739],
    [1.16,4.0822034254848605],
    [1.18,4.392179271651524],
    [1.2,4.354670863894368],
    [1.21,4.3814820285992955],
    [1.22,4.38048290668484],
    [1.23,4.450858881569085],
    [1.24,4.195113981154601],
    [1.25,4.571599403629592],
    [1.26,4.24956051095992],
    [1.28,4.296851775570225],
    [1.29,4.642865893081673],
    [1.31,4.744463026704357],
    [1.32,4.690899406628589],
    [1.33,4.814740917620193],
    [1.34,4.781320855382929],
    [1.35,4.888669389128481],
    [1.36,4.977729957266781],
    [1.38,4.96795710482309],
    [1.39,4.992022369941537],
    [1.41,4.997072915153179],
    [1.42,5.103735394029319],
    [1.43,4.869755192970345],
    [1.44,5.167766458437441],
    [1.45,5.332377307624162],
    [1.48,5.275314628436214],
    [1.49,5.431004163906851],
    [1.51,5.512241676895011],
    [1.55,5.584387758972728],
    [1.57,5.54618761788496],
    [1.58,5.72959294314331],
    [1.59,5.630123625776122],
    [1.6,5.75162790255174],
    [1.62,5.75350652821758],
    [1.64,5.351480085018165],
    [1.66,6.057758355786358],
    [1.67,6.201843131100389],
    [1.68,5.989534880250277],
    [1.7,5.7952019290033245],
    [1.71,5.827876723537762],
    [1.73,5.4551626151086925],
    [1.74,6.397591242211564],
    [1.75,6.354121915262844],
    [1.76,6.482759035000638],
    [1.77,6.490067372762004],
    [1.78,6.512269539669171],
    [1.79,6.46677962778424],
    [1.8,5.80661381754448],
    [1.81,6.618802381176703],
    [1.82,6.904028210858657],
    [1.83,6.778900186277621],
    [1.84,6.385193244174278],
    [1.85,6.445360656652493],
    [1.86,5.960137013357422],
    [1.87,6.924296124272049],
    [1.88,6.558885854405089],
    [1.89,6.9230934941983655],
    [1.9,5.367050055438084],
    [1.91,6.897943917001287],
    [1.93,6.8827546465478395],
    [1.94,7.150701052372046],
    [1.95,7.00207463077538],
    [1.96,7.17482719852679],
    [1.98,7.193926478202968],
    [1.99,7.4443191689551655],
    [2.0,6.735168249530295],
    [2.03,7.434602487078628],
    [2.04,7.553866170223486],
    [2.05,7.587166728228497],
    [2.06,6.740139208273913],
    [2.07,7.3489279301958454],
    [2.08,7.19577632020833],
    [2.09,7.684694491046223],
    [2.1,6.9152800711375395],
    [2.11,7.676140256073087],
    [2.14,7.779573635410657],
    [2.15,7.944332270550715],
    [2.18,8.027942895164841],
    [2.19,8.096152958878928],
    [2.2,7.992577871879778],
    [2.21,7.940986490102238],
    [2.23,7.973003584545139],
    [2.24,8.183127548229235],
    [2.25,8.25020498854066],
    [2.26,8.284491702462264],
    [2.27,8.168305699046744],
    [2.28,7.714862978147283],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_5=[
    [0.11,0.2560276801644294],
    [0.14,0.282979696534077],
    [0.21,0.6082068488057842],
    [0.23,0.7535010041376589],
    [0.24,0.6337140623269877],
    [0.25,0.8418138268234472],
    [0.27,0.7569282915929978],
    [0.29,0.8418138268234536],
    [0.3,0.9967587610257913],
    [0.31,0.9621643455254703],
    [0.32,1.0156301069483946],
    [0.34,1.164171000174396],
    [0.35,1.1332627474770258],
    [0.36,1.2256994331180935],
    [0.37,1.1240504814101093],
    [0.38,1.2498880226660927],
    [0.4,1.4072466736309994],
    [0.42,1.43972315677913],
    [0.44,1.3884825303273218],
    [0.45,1.4841295828899022],
    [0.46,1.5928648654835462],
    [0.48,1.6636608478386474],
    [0.5,1.7173827355041114],
    [0.51,1.7076961797646244],
    [0.52,1.779218617175605],
    [0.53,1.7678473821080205],
    [0.54,1.8272076529408086],
    [0.55,1.8239407505705092],
    [0.56,2.031399922277341],
    [0.57,1.9198405132902603],
    [0.59,2.009891112408079],
    [0.62,2.237150931577359],
    [0.64,2.325601161258245],
    [0.65,2.325449407001892],
    [0.67,2.4609200181314534],
    [0.68,2.317518442699429],
    [0.72,2.415774975658354],
    [0.73,2.6676335040838626],
    [0.76,2.6214087973921543],
    [0.77,2.7210907643988818],
    [0.8,2.778878317933768],
    [0.85,2.901755583630016],
    [0.88,3.0669150684467263],
    [0.92,3.254674785362977],
    [0.95,3.468896097955137],
    [1.01,3.6015490311770297],
    [1.02,3.5765201234959694],
    [1.05,3.812080862253209],
    [1.08,3.9574204313653896],
    [1.1,3.9664530972911316],
    [1.18,4.2001786088237765],
    [1.21,4.318800294776223],
    [1.23,4.3691678477326645],
    [1.25,4.26567923983539],
    [1.26,4.571423010381007],
    [1.27,4.449608831788756],
    [1.28,4.781176470588235],
    [1.33,4.553777093045814],
    [1.39,4.954594666014386],
    [1.4,5.029018629285682],
    [1.43,5.2324043294200395],
    [1.45,5.243628527881084],
    [1.48,5.47793813659608],
    [1.54,5.617175834871257],
    [1.55,5.513591385421838],
    [1.59,5.184541301996801],
    [1.65,4.953986755643029],
    [1.66,4.9525560839536125],
    [1.68,5.102843226725651],
    [1.72,5.827343168932769],
    [1.8,6.386809937399929],
    [1.81,6.400664325382823],
    [1.82,6.584457997356407],
    [1.83,6.684500069299915],
    [1.87,6.750407395113272],
    [1.92,6.719999999999998],
    [2.0,7.16966466088066],
    [2.04,7.29639433160068],
    [2.16,7.467059472284235],
    [2.2,7.174012307987475],
    [2.26,8.262521712643363],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_10=[
    [0.12,0.22588235294116998],
    [0.16,0.28297969653407967],
    [0.22,0.5596637646049363],
    [0.24,0.6964705882352931],
    [0.26,0.6946208925880835],
    [0.27,0.7571529113629546],
    [0.31,0.9271443967403199],
    [0.36,1.142046969382967],
    [0.37,1.1905045308869229],
    [0.38,1.101618815126549],
    [0.4,1.2434763130728423],
    [0.43,1.36687859498406],
    [0.45,1.517601458503258],
    [0.46,1.404719676747722],
    [0.52,1.7045430848258658],
    [0.54,1.8840462971559366],
    [0.55,1.9308574211015321],
    [0.65,2.240711701075273],
    [0.75,2.5779302875512413],
    [0.98,3.410385116610533],
    [1.25,4.624807486875259],
    [1.72,6.28238892386768],
    [1.73,6.117647058823536],
    [1.99,7.0567902954074295],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_20=[
    [0.27,0.8512315523459673],
    [0.31,0.9826170831915824],
    [0.41,1.224831885929222],
    [0.49,1.6609564926837277],
    [0.61,1.949757859156508],
    [0.68,2.1991328898290874],
    [0.77,2.8178138228925564],
    [0.8,2.8723620363422335],
    [0.87,3.07140940112883],
    [0.97,3.4742544942271296],
    [1.73,5.873277037739675],
    [1.74,5.9357442320008325],
    [1.87,6.643025949943768],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_30=[
    [0.04,0.08418138268235108],
    [0.43,1.3585581609988513],
    [0.53,1.712941176470565],
    [0.58,1.9259883545516296],
    [0.78,2.5779302875512484],
    [1.17,4.0826234865429365],
    [1.74,5.650195207455487],
    [1.75,5.916958596557621],
    [1.92,5.721981412087663],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_40=[
    [0.48,1.5321242913976192],
    [0.49,1.594787356609907],
    [0.7,2.3828684990441715],
    [0.77,2.7043719569728033],
    [1.75,5.402484114004972],
    [1.76,6.034168858798628],
    [2.17,7.9931098356203405],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_50=[
    [0.51,1.610594680518186],
    [0.67,2.4105879482100194],
    [0.9,3.290889174234433],
    [1.6,5.8148865156863945],
    [1.77,5.904232963029492],
    [1.83,6.628502155875777],
    [2.23,7.773775807895333],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_60=[
    [0.42,1.0880260530159807],
    [0.95,3.069793902214946],
    [1.13,3.843135974389552],
    [1.46,4.97546867956325],
    [1.59,5.349658980820421],
    [1.78,6.243332690398931],
    [1.79,6.102923110411503],
    [1.91,6.82349695732647],
    [1.92,7.0258933848067535],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_70=[
    [0.53,1.5760139812844765],
    [0.54,1.5362814044416588],
    [0.62,1.854284853613138],
    [0.64,2.0709304530033052],
    [1.11,3.7346565458648135],
    [1.56,5.465764350097404],
    [1.58,5.491472344654998],
    [1.79,5.8353867442011085],
    [1.8,6.070588235294117],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_80=[
    [0.35,0.6726613980312662],
    [0.49,1.2262774569338264],
    [0.85,2.5804717789729983],
    [0.89,2.729346855211955],
    [0.92,2.9118120019925873],
    [0.95,2.9703624841418264],
    [0.96,3.2159601987586854],
    [1.8,6.117647058823529],
    [1.81,6.047235801984203],
    [2.02,6.902873379952295],
    [2.2,7.293941553851637],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_90=[
    [0.0,0.07529411764705429],
    [0.05,0.0],
    [0.48,1.1370720610288194],
    [0.49,0.9788235294117698],
    [0.58,1.3964068393795563],
    [0.66,1.7882352941176407],
    [0.82,2.57683048789047],
    [0.83,2.5411764705882405],
    [1.07,3.438322597392075],
    [1.82,6.185463713821642],
    [1.83,6.3061352012520775],
    [2.0,6.925652031062733],
    [2.34,7.914840862730782],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_100=[
    [0.39,0.6718708064969295],
    [0.49,1.1078730518258586],
    [1.15,3.633672587147651],
    [1.83,6.083963290347695],
    [1.84,6.123825958099689],
    [1.93,5.535814065721696],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_110=[
    [0.48,1.089327909363219],
    [0.61,1.678252510169219],
    [0.63,1.5504007741721637],
    [0.67,1.6920248511430882],
    [0.71,1.919630875705513],
    [1.04,3.14437466621306],
    [1.71,5.437785016194812],
    [1.84,6.249525158432625],
    [1.85,6.1083077523400515],
    [1.91,6.47433645449104],
    [2.21,7.525128193277472],
    [2.23,7.674092306818048],
    [2.28,7.465232355234951],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_120=[
    [0.3,0.30352029170064715],
    [0.44,0.9097822850706495],
    [1.85,5.647075630198509],
    [2.25,7.695670287666354],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_130=[
    [0.45,0.9345066714245784],
    [0.55,1.35738400958645],
    [1.02,2.789441287957493],
    [1.13,3.339884241104585],
    [1.28,3.876001935430391],
    [1.46,4.672256332732015],
    [1.65,5.17989191748405],
    [1.87,6.094766856160227],
    [1.88,6.023544117611156],
    [2.2,7.365293718317926],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_140=[
    [0.68,1.5069408044894481],
    [0.81,2.0417239475993574],
    [1.25,3.6219522923838277],
    [1.88,5.981585813212206],
    [1.89,6.030171677139421],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_150=[
    [0.8,2.025695147461674],
    [0.94,2.267122011390835],
    [0.98,2.877538355890218],
    [1.17,3.470887325098502],
    [1.89,6.086400770142318],
    [1.9,6.310764823328627],
    [1.93,6.27896626054305],
    [2.01,6.852100832091482],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_160=[
    [0.52,1.1653877979982439],
    [0.7,1.7089028026565243],
    [0.95,2.6224223462168887],
    [0.98,2.905477466434471],
    [1.04,2.8245331549218164],
    [1.22,3.7232541483609682],
    [1.83,5.696847182439543],
    [1.9,5.820745601062304],
    [1.91,6.234950235235468],
    [2.47,8.360042052178134],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_170=[
    [0.5,0.9254210675412282],
    [0.67,1.431083505599859],
    [1.12,3.3144916158108315],
    [1.13,3.2299772353960057],
    [1.24,3.7758423519961717],
    [1.28,3.836353516622032],
    [1.37,4.087870825903544],
    [1.38,4.234624783711481],
    [1.47,4.363203166082467],
    [1.55,4.8270885004320565],
    [1.75,5.811839008812951],
    [1.76,5.638424772047116],
    [1.89,6.726350599511097],
    [1.92,6.059713401962745],
    [1.93,5.964093021217431],
    [2.0,6.588235294117649],
]
# time in seconds, map distance [seconds,distance]
data_distance_time_180=[
    [0.39,0.47990771892637807],
    [0.56,1.1394067539140886],
    [0.59,1.1319187861363122],
    [0.64,1.3986528367631006],
    [0.72,1.6432628526100563],
    [0.77,1.7981151223099112],
    [0.79,1.8023929463608175],
    [0.84,1.9234110415098706],
    [0.87,2.299939520793533],
    [0.88,2.3229378660002142],
    [0.91,2.436683888751765],
    [0.96,2.548138610951694],
    [0.97,2.697142924699838],
    [0.98,2.579922479455539],
    [1.05,2.8893351206542963],
    [1.11,3.2304708431608105],
    [1.14,3.322286987213737],
    [1.28,3.7710834409319447],
    [1.3,3.915882308759466],
    [1.31,3.8537154747153792],
    [1.33,3.9248940551591955],
    [1.46,4.333828948678222],
    [1.49,4.531915806011126],
    [1.51,4.391735554023108],
    [1.52,4.901207534283527],
    [1.56,4.953486067554171],
    [1.57,4.828166813858472],
    [1.58,4.389179931510051],
    [1.6,4.888802830440743],
    [1.61,5.1545546762096315],
    [1.62,4.826281818239794],
    [1.65,5.187547506765414],
    [1.67,5.170032359867395],
    [1.68,5.282708752591407],
    [1.69,5.101211200229079],
    [1.7,5.343612861978304],
    [1.71,4.4260918735783585],
    [1.72,5.008650786285861],
    [1.73,5.239960298538663],
    [1.74,5.36945919451135],
    [1.75,5.398150249800312],
    [1.76,5.333197275809474],
    [1.77,5.501110048408943],
    [1.79,5.48592057611793],
    [1.8,5.5921408024409835],
    [1.81,5.596879166633766],
    [1.82,5.568668260198514],
    [1.83,5.753546940976932],
    [1.84,5.7532474883377365],
    [1.87,5.904351700633396],
    [1.89,6.007000196271169],
    [1.9,5.770321530568158],
    [1.92,6.001878782358218],
    [1.93,5.832181293476167],
    [1.94,6.127680695994403],
    [1.95,6.085438149322457],
    [1.96,6.1424829188857615],
    [1.97,6.2109932851855385],
    [1.98,6.21116527168873],
    [1.99,6.415994472820792],
    [2.0,6.421822475725911],
    [2.01,6.440703064017083],
    [2.02,6.432504868082958],
    [2.03,6.5442259430099154],
    [2.05,6.656922149291872],
    [2.06,6.614803572108394],
    [2.08,6.738179230988936],
    [2.1,6.853858762098599],
    [2.12,6.893113759473151],
    [2.13,7.0996903290330975],
    [2.15,7.175098808140167],
    [2.18,7.065245705976063],
    [2.19,7.15650685121021],
    [2.22,7.322957785392699],
    [2.24,7.325836159273965],
    [2.35,7.897362355871147],
]

#index_for_fit=0
index_for_fit=-10
fit_i=[]
fit_slope=[]
fit_b=[]

# x is distance
# return value is seconds
def objective(x,a,b):
    return a*x+b

def eval_array(name,data):
    print("evaluating",name)
    l=len(data)

    skip_below=1.0

    secs=[]
    dist=[]
    for d in data:
        if d[1] >= skip_below:
            secs.append(d[0])
            dist.append(d[1])

    params,_ = curve_fit(objective,dist,secs)
    a,b=params
    print(a,b)

    global index_for_fit
    fit_i.append(index_for_fit)
    index_for_fit+=1
    fit_slope.append(a)
    fit_b.append(b)

def eval_data():
    random.seed()
    eval_array("data_distance_time_1",data_distance_time_1)
    eval_array("data_distance_time_5",data_distance_time_5)
    eval_array("data_distance_time_10",data_distance_time_10)
    eval_array("data_distance_time_20",data_distance_time_20)
    eval_array("data_distance_time_30",data_distance_time_30)
    eval_array("data_distance_time_40",data_distance_time_40)
    eval_array("data_distance_time_50",data_distance_time_50)
    eval_array("data_distance_time_60",data_distance_time_60)
    eval_array("data_distance_time_70",data_distance_time_70)
    eval_array("data_distance_time_80",data_distance_time_80)
    eval_array("data_distance_time_90",data_distance_time_90)
    eval_array("data_distance_time_100",data_distance_time_100)
    eval_array("data_distance_time_110",data_distance_time_110)
    eval_array("data_distance_time_120",data_distance_time_120)
    eval_array("data_distance_time_130",data_distance_time_130)
    eval_array("data_distance_time_140",data_distance_time_140)
    eval_array("data_distance_time_150",data_distance_time_150)
    eval_array("data_distance_time_160",data_distance_time_160)
    eval_array("data_distance_time_170",data_distance_time_170)
    eval_array("data_distance_time_180",data_distance_time_180)

    print("meta slope")
    params,_ = curve_fit(objective,fit_i,fit_slope)
    a,b=params
    print(a,b)

    print("meta offset")
    params,_ = curve_fit(objective,fit_i,fit_b)
    a,b=params
    print(a,b)

#index_for_fit=0
# meta slope
# -0.0014280442916581038 0.2840421234392343
# meta offset
# 0.01950835432739212 -0.01372136715364619

#index_for_fit=-10
# meta slope
# -0.0014280442916581038 0.26976168054446614
# meta offset
# 0.01950835441527321 0.1813621758484305

def main(args):
    print("eval data")
    args.pop(0)
    for arg in args:
        print(f"arg=[{arg}]")
    eval_data()

if __name__ == "__main__":
    main(sys.argv)

